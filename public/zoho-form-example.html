<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoho WebToLead Form Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .form-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background-color: #fafafa;
        }
        .debug-info {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 4px;
            font-size: 12px;
            color: #666;
        }
        .debug-info h3 {
            margin-top: 0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="ebook-title">Download AI Content Generation Guide</h1>
        <p class="subtitle">Fill out the form below to receive your free eBook. All fields are required.</p>
        
        <div class="form-container">
            <iframe 
                id="zoho-form-iframe"
                src=""
                width="100%" 
                height="600" 
                frameborder="0"
                title="Download eBook">
            </iframe>
        </div>
        
        <div class="debug-info">
            <h3>Debug Information</h3>
            <p><strong>Current URL:</strong> <span id="current-url"></span></p>
            <p><strong>Form URL:</strong> <span id="form-url"></span></p>
            <p><strong>UTM Parameters:</strong> <span id="utm-params"></span></p>
            <p><strong>eBook Name:</strong> <span id="ebook-name"></span></p>
        </div>
    </div>

    <script>
        // Zoho Form Utilities
        function extractUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const params = {};
            
            // Extract UTM parameters
            const utmKeys = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content'];
            utmKeys.forEach(key => {
                const value = urlParams.get(key);
                if (value) params[key] = value;
            });
            
            // Extract ebook parameter
            const ebook = urlParams.get('ebook');
            if (ebook) params.ebook = ebook;
            
            // Extract referrer
            if (document.referrer) {
                params.referrer = document.referrer;
            }
            
            return params;
        }

        function formatEbookName(ebookSlug) {
            return ebookSlug
                .replace(/-/g, ' ')
                .replace(/\b\w/g, l => l.toUpperCase());
        }

        function buildZohoFormUrl(ebookName, utmParams) {
            const baseUrl = 'https://crm.zoho.eu/crm/WebToLeadForm';
            const params = new URLSearchParams();
            
            // Add ebook information
            params.append('Ebook_Name__c', ebookName);
            params.append('Content_Type__c', 'eBook');
            
            // Add UTM parameters
            Object.entries(utmParams).forEach(([key, value]) => {
                if (key.startsWith('utm_') && value) {
                    params.append(key, value);
                }
            });
            
            return `${baseUrl}?${params.toString()}`;
        }

        function updateForm() {
            const params = extractUrlParams();
            const ebookSlug = params.ebook || 'ai-content-guide';
            const ebookName = formatEbookName(ebookSlug);
            const formUrl = buildZohoFormUrl(ebookName, params);
            
            // Update iframe
            const iframe = document.getElementById('zoho-form-iframe');
            if (iframe) {
                iframe.src = formUrl;
            }
            
            // Update title
            const title = document.getElementById('ebook-title');
            if (title) {
                title.textContent = `Download ${ebookName}`;
            }
            
            // Update debug info
            document.getElementById('current-url').textContent = window.location.href;
            document.getElementById('form-url').textContent = formUrl;
            document.getElementById('utm-params').textContent = JSON.stringify(params);
            document.getElementById('ebook-name').textContent = ebookName;
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', updateForm);
        
        // Update when URL changes (for SPA navigation)
        window.addEventListener('popstate', updateForm);
        
        // Example URLs to test:
        // ?ebook=crm-playbook&utm_source=google&utm_campaign=spring2024
        // ?ebook=ai-automation-guide&utm_source=linkedin&utm_medium=social
        // ?ebook=content-strategy&utm_source=email&utm_campaign=newsletter
    </script>
</body>
</html>
